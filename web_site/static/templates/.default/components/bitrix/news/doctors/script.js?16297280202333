let timer = null;
$(document).ready(function () {

});

class doctorsList {
    constructor(params) {
        this.params = params;
        this.timer = null;
        this.pages = params.pages;
        this.page = 1;
        this.filter = {
            q: '',
            direction: '',
            mode: 'ajax',
            ajax_id: params.ajax_id,
            excludeID: params.exclude_ids
        };
        let self = this;

        $('.js-filter').on('submit', function () {
            self.filter.q = $(this).find('.js-search').val();
            self.filter.direction = $(this).find('select[name="direction"]').val();
            self.page = 1;
            history.replaceState({}, '', '?' + (new URLSearchParams({q: self.filter.q, direction: self.filter.direction})).toString());
            self.load();
            return false;
        });

        $('select[name="direction"]').on('change', function () {
            $(this).closest('.js-filter').submit();
        });

        $('.js-search').on('input', function () {
            clearTimeout(self.timer);
            self.timer = setTimeout(() => {
                $(this).closest('.js-filter').submit();
            }, 1000);
        });

        $('#searchclear').on('click', function () {
            $(this).closest('.js-filter').find('.js-search').val('');
            $(this).closest('.js-filter').submit();
        });

        $('.js-show-more').on('click', (e) => {
            this.showMore(e);
        });
    }

    showMore(e) {
        this.page++;
        this.excludeID = this.params.exclude_ids;
        if (this.page <= this.pages) {
            this.load();
        }

        this.checkShowMore();
    }

    checkShowMore(){
        if (this.page >= this.pages) {
            $('.js-show-more').hide();
        }else {
            $('.js-show-more').show();
        }
    }

    load() {
        this.filter[this.params.pagen] = this.page;
        $.post('', this.filter, (response) => {
            if (this.page > 1) {
                $('.js-items').append(response.html);
            } else {
                $('.js-items').html(response.html);
            }
            this.pages = response.pages;
            this.checkShowMore();
        }, 'json');
    }
}
